# Confluence MCP Workflow: Publishing Performance Test Reports

This workflow publishes performance test reports (generated by the PerfReport MCP) to Confluence as formatted pages. The workflow locates the target Confluence space and parent page, then creates a new page from the Markdown report, automatically converting it to Confluence's XHTML format.

0. **Prerequisites:**
   - Test run ID (test_run_id) should be the same as the run_id from the PerfReport workflow
   - Confluence mode (mode) must be provided by the user: either "cloud" or "onprem"
   - Confluence Space name should be provided by the user (e.g., "Quality Engineering")
   - Parent Page information is REQUIRED - user must provide either:
     - Parent Page name (e.g., "AI Generated Test Reports"), OR
     - Parent Page ID (e.g., "1234567890")
   - PerfReport workflow must be completed first (required files: `artifacts/{test_run_id}/reports/*.md`)
   Do not proceed until mode, Confluence Space name, parent page information (name or ID), and test_run_id are provided, and PerfReport workflow has completed successfully.

1. **Find the Space in Confluence** using `list_spaces` with the provided mode.
   - This lists all available Confluence spaces.
   - Search for the space that matches the provided Confluence Space name.
   - Extract the space_ref (space_id for cloud, space_key for onprem) from the matching space result.

2. **Get space details** using `get_space_details` with the space_ref and mode from step 1.
   - This retrieves detailed metadata for the selected space.

3. **Locate the parent Page** (REQUIRED):
   - If parent page ID is provided by the user, use `get_page_by_id` with the parent_id and mode to get page details and verify it exists.
   - If parent page name is provided, use `list_pages` with the space_ref and mode to search for the parent page by name, then extract its page_ref (page ID).
   - Store the parent page ID (parent_id) for use in step 5.

4. **List available reports** using `get_available_reports` with the test_run_id.
   - This lists all available Markdown reports for the given test_run_id from `artifacts/{test_run_id}/reports/`.
   - Select the report filename to publish (typically `performance_report_{test_run_id}.md`).

5. **Create a Performance Test report page** using `create_page` with:
   - space_ref: The space_ref (space_id for cloud, space_key for onprem) from step 1
   - test_run_id: The test run ID from prerequisites
   - filename: The report filename selected from step 4 (e.g., `performance_report_{test_run_id}.md`)
   - mode: The Confluence mode ("cloud" or "onprem") from prerequisites
   - parent_id: The parent page ID from step 3 (REQUIRED - must be provided)
   - The tool will automatically convert the Markdown report to Confluence XHTML format and create the page nested under the parent page. 
