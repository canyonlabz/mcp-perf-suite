---
description: JMeter Correlation Naming Rules
alwaysApply: false
---
# JMeter Correlation Naming Rules (.mdc)

## Purpose

Given a `correlation_spec.json` file produced by the JMeter MCP's `analyze_network_traffic` tool,
generate a `correlation_naming.json` object that assigns meaningful, consistent JMeter variable 
names and hints for each `correlation_id`.

## Input Schema (correlation_spec.json)

```jsonc
{
  "capture_file": "network_capture_*.json",
  "application": "string",
  "spec_version": "2.0",
  "analyzer_version": "2.0.0",
  "analysis_timestamp": "ISO8601 timestamp",
  "total_steps": number,
  "total_entries": number,
  "correlations": [
    {
      "correlation_id": "corr_1",
      "type": "business_id" | "correlation_id" | "oauth_param",
      "value_type": "business_id_numeric" | "business_id_guid" | "oauth_state" | "oauth_nonce" | "oauth_code" | "correlation_id",
      "confidence": "high" | "low",
      "correlation_found": true | false,
      "source": {
        "step_number": number,
        "step_label": "Step N: Description...",
        "entry_index": number,
        "request_id": "uuid",
        "request_method": "GET" | "POST" | etc,
        "request_url": "https://...",
        "response_status": number | null,
        "source_location": "response_json" | "response_header" | "response_redirect_url" | "request_url_path",
        "source_key": "field_name" | null,
        "source_json_path": "$.path.to.value" | null,
        "response_example_value": "actual_value"
      },
      "usages": [
        {
          "location_type": "request_url_path" | "request_query_param" | "request_header" | "request_body_json" | "request_body_form",
          "location_key": "param_name" | null,
          "location_json_path": "$.path" | null,
          "location_pattern": "param={VALUE}",
          "request_example_fragment": "snippet showing value in context",
          "usage_number": number,
          "entry_index": number,
          "step_number": number,
          "step_label": "Step N: Description...",
          "request_id": "uuid",
          "request_method": "GET" | "POST",
          "request_url": "https://..."
        }
      ],
      "parameterization_hint": {
        "strategy": "extract_and_reuse" | "csv_dataset" | "user_defined_variable",
        "extractor_type": "json" | "regex",
        "reason": "explanation"
      },
      "notes": "Optional notes for low-confidence or orphan IDs"
    }
  ],
  "summary": {
    "total_correlations": number,
    "business_ids": number,
    "correlation_ids": number,
    "oauth_params": number,
    "orphan_ids": number,
    "high_confidence": number,
    "low_confidence": number
  }
}
```

## Output Schema (correlation_naming.json)

Return a JSON object with:

```json
{
  "application": "<same as input application>",
  "spec_version": "2.0",
  "naming_conventions": {
    "case_style": "snake_case",
    "id_suffix": "_id",
    "token_suffix": "_token"
  },
  "variables": [
    {
      "correlation_id": "corr_1",
      "variable_name": "product_id",
      "jmeter_scope": "thread",
      "jmeter_extractor_type": "json_extractor",
      "jmeter_extractor_expression": "$.items[0].productId",
      "jmeter_extractor_name": "Extract product_id from ProductList response",
      "source_request_url": "https://api.example.com/products/list",
      "intended_usage": [
        "URL path parameter in product detail requests"
      ],
      "comments": "Business ID for product entity, extracted from product list response."
    }
  ],
  "orphan_variables": [
    {
      "correlation_id": "corr_15",
      "variable_name": "user_id",
      "parameterization_strategy": "csv_dataset",
      "csv_column_suggestion": "userId",
      "comments": "Numeric ID found in request URL but no source detected. Recommend CSV parameterization."
    }
  ]
}
```

## Naming Conventions

### CRITICAL: Variable Names Must Be Unique

**Every `correlation_id` MUST have a unique `variable_name`.** Duplicate variable names will cause JMeter scripts to fail because different values will overwrite each other.

#### Uniqueness Rules (MANDATORY)

1. **Never assign the same variable name to multiple correlations.**
2. **Before finalizing output, verify ALL variable names are unique.**
3. **If two correlations seem similar, differentiate them using:**
   - The `source.source_key` field name
   - The `usages[*].location_key` parameter name
   - A numeric suffix (`_1`, `_2`) as a last resort

#### Common Duplicate Name Mistakes to AVOID

| BAD (Duplicates) | GOOD (Unique) | Reason |
|------------------|---------------|--------|
| `oauth_state` for both `state` and `client_id` | `oauth_state`, `oauth_client_id` | Different OAuth parameters |
| `oauth_state` for both `state` and `nonce` | `oauth_state`, `oauth_nonce` | Different OAuth parameters |
| `redirect_uri` for all redirect URLs | `oauth_redirect_uri`, `app_redirect_uri` | Different redirect contexts |
| `transaction_id` for multiple headers | `request_transaction_id`, `response_transaction_id` | Different source locations |

#### OAuth Parameters - Use Specific Names

OAuth flows have many parameters. Each MUST have a distinct variable name:

| OAuth Parameter | Required Variable Name |
|-----------------|----------------------|
| `state` | `oauth_state` |
| `nonce` | `oauth_nonce` |
| `code` | `oauth_code` or `authorization_code` |
| `client_id` | `oauth_client_id` |
| `redirect_uri` | `oauth_redirect_uri` |
| `code_challenge` | `oauth_code_challenge` |
| `code_verifier` | `oauth_code_verifier` |
| `response_mode` | `oauth_response_mode` |
| `scope` | `oauth_scope` |
| `access_token` | `bearer_token` or `access_token` |
| `id_token` | `id_token` |
| `refresh_token` | `refresh_token` |

### General Rules
- Use `snake_case` for all variable names.
- Do not embed literal values in variable names.
- Prefer short, descriptive names that reflect the domain.
- Use singular nouns for IDs (e.g., `product_id` not `products_id`).
- **Each correlation_id gets exactly ONE unique variable_name.**

### By Correlation Type

| Type | Naming Pattern | Examples |
|------|----------------|----------|
| `business_id` | `<resource>_id` | `product_id`, `order_id`, `customer_id`, `item_id` |
| `correlation_id` | `<purpose>_id` or `transaction_id` | `request_id`, `trace_id`, `session_id` |
| `oauth_param` | Keep standard OAuth names | `oauth_state`, `oauth_nonce`, `oauth_client_id`, `auth_code` |

### Context-Based Naming

Infer the resource name from:
1. **`source.source_key`** - The JSON field name (e.g., `productId` → `product_id`)
2. **`source.source_json_path`** - The path context (e.g., `$.items[0].orderId` → `order_id`)
3. **`source.request_url`** - API endpoint (e.g., `/products/` → `product_id`)
4. **`usages[*].request_url`** - Where it's used (e.g., `/orders/details/` → `order_id`)
5. **`source.step_label`** - Business context from step description

### Special Cases

| URL/Context Pattern | Suggested Variable Name |
|---------------------|------------------------|
| `/cart` or "cart" in step | `cart_id` |
| `/order` or "order" in step | `order_id` |
| `/product` or "product" in step | `product_id` |
| `/user` or "user" in step | `user_id` |
| `/customer` | `customer_id` |
| `/item` | `item_id` |
| `/account` | `account_id` |
| OAuth `state` parameter | `oauth_state` |
| OAuth `nonce` parameter | `oauth_nonce` |
| OAuth `client_id` | `oauth_client_id` |

## Extractor Type Selection

| source_location | Recommended Extractor |
|-----------------|----------------------|
| `response_json` | `json_extractor` |
| `response_header` | `regex_extractor` |
| `response_redirect_url` | `regex_extractor` + URL decode |
| `response_cookie` | `regex_extractor` |

### JSON Extractor Expression
When `source_location` is `response_json`, use `source.source_json_path` directly:
```
jmeter_extractor_expression: "$.items[0].productId"
```

### Regex Extractor Expression
When `source_location` is `response_header` or `response_redirect_url`:
```
jmeter_extractor_expression: "transactionid:\\s*([^\\r\\n]+)"
jmeter_extractor_expression: "[?&]code=([^&]+)"
```

## Handling Orphan IDs (Low Confidence)

For correlations where `correlation_found: false`:
- These are IDs found in requests with no identifiable source
- Place them in the `orphan_variables` array
- Suggest `csv_dataset` for IDs appearing 3+ times
- Suggest `user_defined_variable` for IDs appearing 1-2 times
- Provide a `csv_column_suggestion` that matches the variable name

### CRITICAL: Orphan Variable Naming Rules

**Orphan variable names MUST NOT be:**
- Empty/blank (NEVER leave `variable_name` empty)
- Just a number suffix like `_22`, `_23`
- Generic names like `value` or `value_19`

**Naming Strategy for Orphans:**

1. **If `source_key` exists and is meaningful** → Use it directly
   - `source_key: "pageSize"` → `page_size`
   - `source_key: "appGuid"` → `app_guid`
   - `source_key: "teamId"` → `team_id`

2. **If `source_key` is `"_"` (underscore)** → This is a cache-busting timestamp
   - Common in SignalR, jQuery AJAX calls
   - Name as `signalr_timestamp_N` or `cache_timestamp_N` where N is the step number
   - Example: Step 8 with `source_key: "_"` → `signalr_timestamp_8`

3. **If `source_key` is null and `source_location` is `"request_url_path"`**
   - Examine the `request_url` to infer context
   - `/ProductWidget/1` → `widget_id` or `product_widget_id`
   - `/api/users/123` → `user_id`
   - `/reports/456` → `report_id`

4. **If `source_key` is null and no context is available**
   - Use `orphan_<step_number>_<entry_index>` format
   - Example: Step 5, entry 37 → `orphan_step5_entry37`
   - This is better than `value_19` because it provides traceability

### SignalR/WebSocket Specific Patterns

| Pattern in URL | source_key | Variable Name |
|----------------|------------|---------------|
| `/signalr/negotiate?...&_=timestamp` | `_` | `signalr_timestamp_N` |
| `/signalr/start?...&_=timestamp` | `_` | `signalr_start_timestamp_N` |
| `/signalr/connect?...&connectionToken=` | `connectionToken` | `signalr_connection_token` |
| `/signalr/...&connectionData=` | `connectionData` | `signalr_connection_data` |

### URL Path Segment Naming

When `source_location: "request_url_path"` and `source_key: null`:

| URL Pattern | Example Value | Variable Name |
|-------------|---------------|---------------|
| `/api/.../Widget/N` | `1`, `2` | `widget_id` |
| `/api/.../User/N` | `12345` | `user_id` |
| `/api/.../Product/N` | `1119216` | `product_id` |
| `/api/.../Report/N` | `456` | `report_id` |
| Path segment is GUID | `326BABA4-...` | `path_guid` |

**Rule: Extract the noun from the URL path preceding the value.**

## Instructions

1. Read the entire `correlation_spec.json` file.

2. For each correlation with `correlation_found: true`:
   - Infer the resource/purpose from source_key, source_json_path, URLs, and step labels
   - Generate a descriptive `variable_name` following naming conventions
   - **IMPORTANT:** Check that this variable_name is not already used by another correlation
   - Set `jmeter_scope` to `"thread"` (default)
   - Set `jmeter_extractor_type` based on `source_location`
   - Generate `jmeter_extractor_expression` (JSONPath or regex)
   - Compose `jmeter_extractor_name` (e.g., "Extract product_id from ProductList response")
   - List `intended_usage` based on usage locations
   - Add contextual `comments`

3. For each correlation with `correlation_found: false`:
   - Place in `orphan_variables` array
   - Suggest parameterization strategy based on `parameterization_hint`
   - Provide `csv_column_suggestion`
   - **IMPORTANT:** Ensure orphan variable names are also unique

4. **VALIDATE UNIQUENESS (MANDATORY STEP):**
   - Before returning output, collect ALL variable_name values from both `variables` and `orphan_variables`
   - Verify there are NO duplicates
   - If duplicates exist, rename using more specific context (source_key, location_key, step_number suffix)
   - Example: If two correlations both want `transaction_id`, rename to `request_transaction_id` and `response_transaction_id`

5. **VALIDATE VARIABLE NAMES (MANDATORY STEP):**
   - Check that NO variable_name is empty (`""`)
   - Check that NO variable_name is just a number suffix (`_22`, `_23`)
   - Check that NO variable_name is overly generic (`value`, `value_19`, `id`)
   - If any fail validation, re-derive the name using orphan naming rules above

6. Return only valid JSON matching the output schema, with no additional text.

## Example Transformation

**Input (from correlation_spec.json):**
```json
{
  "correlation_id": "corr_7",
  "type": "business_id",
  "value_type": "business_id_numeric",
  "confidence": "high",
  "correlation_found": true,
  "source": {
    "step_number": 4,
    "step_label": "Step 4: Navigate to the Products page.",
    "request_url": "https://api.example.com/catalog/products/list",
    "source_location": "response_json",
    "source_key": "productId",
    "source_json_path": "$.items[0].productId",
    "response_example_value": "12345"
  },
  "usages": [
    {
      "location_type": "request_url_path",
      "request_url": "https://api.example.com/catalog/products/details/12345"
    }
  ]
}
```

**Output (in correlation_naming.json):**
```json
{
  "correlation_id": "corr_7",
  "variable_name": "product_id",
  "jmeter_scope": "thread",
  "jmeter_extractor_type": "json_extractor",
  "jmeter_extractor_expression": "$.items[0].productId",
  "jmeter_extractor_name": "Extract product_id from ProductList response",
  "source_request_url": "https://api.example.com/catalog/products/list",
  "intended_usage": [
    "URL path parameter in product details API calls"
  ],
  "comments": "Product ID extracted from catalog list response, used in product detail endpoints."
}
```

## BAD Example - Duplicate Variable Names (DO NOT DO THIS)

The following shows INCORRECT output where multiple correlations have the same variable name.
This WILL BREAK the JMeter script because values will overwrite each other.

**BAD Output (WRONG - duplicates cause script failure):**
```json
{
  "variables": [
    {
      "correlation_id": "corr_1",
      "variable_name": "oauth_state",  // WRONG: Used for client_id
      "source_key": "client_id"
    },
    {
      "correlation_id": "corr_2", 
      "variable_name": "oauth_state",  // WRONG: Duplicate! Used for state
      "source_key": "state"
    },
    {
      "correlation_id": "corr_3",
      "variable_name": "oauth_state",  // WRONG: Duplicate! Used for nonce
      "source_key": "nonce"
    }
  ]
}
```

**CORRECT Output (each correlation has unique variable name):**
```json
{
  "variables": [
    {
      "correlation_id": "corr_1",
      "variable_name": "oauth_client_id",  // CORRECT: Unique name from source_key
      "source_key": "client_id"
    },
    {
      "correlation_id": "corr_2",
      "variable_name": "oauth_state",  // CORRECT: Unique name
      "source_key": "state"
    },
    {
      "correlation_id": "corr_3",
      "variable_name": "oauth_nonce",  // CORRECT: Unique name from source_key
      "source_key": "nonce"
    }
  ]
}
```
